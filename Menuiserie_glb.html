<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Configurateur Menuiserie Babylon.js</title>
  <style>
    html, body { margin: 0; height: 100%; overflow: hidden; }
    canvas { width: 100%; height: 100%; display: block; }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      z-index: 1;
      font-family: sans-serif;
    }
    label { display: block; margin-top: 5px; }
  </style>
</head>
<body>
  <div id="ui">
    <!-- Les options du configurateur -->
    <label>Largeur (mm): <input type="number" id="width" value="1200"></label>
    <label>Hauteur (mm): <input type="number" id="height" value="2150"></label>
    <label>Ajouter allège :
      <input type="checkbox" id="addAllege">
    </label>
    <div id="allegeHeightSection" style="display: none;">
      <label>Hauteur allège (mm) : <input type="number" id="allegeHeight" value="300"></label>
    </div>
    <label>Ajouter imposte :
      <input type="checkbox" id="addImposte">
    </label>
    <div id="imposteHeightSection" style="display: none;">
      <label>Hauteur imposte (mm) : <input type="number" id="imposteHeight" value="300"></label>
    </div>
    <label>Nombre de vantaux :
      <select id="vantaux">
        <option value="1">1</option>
        <option value="2" selected>2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </label>
    <label>Couleur :
      <select id="couleur">
        <option value="Ral 1015">Ral 1015</option>
        <option value="Ral 3004" selected>Ral 3004</option>
        <option value="Ral 5014">Ral 5014</option>
        <option value="Ral 6019">Ral 6019</option>
        <option value="Ral 7016">Ral 7016</option>
        <option value="Ral 9005">Ral 9005</option>
        <option value="Ral 9010">Ral 9010</option>
      </select>
    </label>
    <label>Ajouter vitrage :
      <input type="checkbox" id="vitrage" checked>
    </label>
    <label><button id="toggleVantaux">Ouvrir les ouvrants</button></label>
  </div>

  <canvas id="renderCanvas"></canvas>

  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true);
    const scene = new BABYLON.Scene(engine);
    scene.clearColor = new BABYLON.Color3(0.9, 0.9, 0.95);

    const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 3 + Math.PI, Math.PI / 3, 5, BABYLON.Vector3.Zero(), scene);
    camera.attachControl(canvas, true);

    camera.wheelPrecision = 20;
    camera.lowerRadiusLimit = 1.5;
    camera.upperRadiusLimit = 20;

    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0), scene);
    light.intensity = 1.5;

    const directionalLight = new BABYLON.DirectionalLight("directionalLight", new BABYLON.Vector3(0, -1, 1), scene);
    directionalLight.intensity = 0.7;

    const shadowGenerator = new BABYLON.ShadowGenerator(1024, directionalLight);
    shadowGenerator.useExponentialShadowMap = true;
    shadowGenerator.bias = 0.01;

    const ralColors = {
      "Ral 1015": new BABYLON.Color3.FromHexString("#FBE8A6"),
      "Ral 3004": new BABYLON.Color3.FromHexString("#641C34"),
      "Ral 5014": new BABYLON.Color3.FromHexString("#5B6470"),
      "Ral 6019": new BABYLON.Color3.FromHexString("#5D8C45"),
      "Ral 7016": new BABYLON.Color3.FromHexString("#383E42"),
      "Ral 9005": new BABYLON.Color3.FromHexString("#0A0A0A"),
      "Ral 9010": new BABYLON.Color3.FromHexString("#FFFFFF")
    };

    // Charger le modèle GLB
    BABYLON.SceneLoader.ImportMesh("", "https://cors-anywhere.herokuapp.com/C:/Users/JeanJacquesGODARD/Desktop/Test%20babylon/", "menuiserie.glb", scene, function (meshes) {
      meshes.forEach(function(mesh) {
        mesh.position = BABYLON.Vector3.Zero();  // Positionner le mesh à l'origine
        mesh.scaling = new BABYLON.Vector3(1, 1, 1);  // Adapter l'échelle si nécessaire
        mesh.receiveShadows = true;
      });

      // Optionnel : ajuster la caméra pour mieux voir le modèle
      scene.createDefaultCameraOrLight(true, true, true);
    });

    // Le reste du code de votre projet pour la création des éléments de menuiserie...
    // (frames, vantaux, meneaux, etc.)

    engine.runRenderLoop(() => scene.render());
    window.addEventListener("resize", () => engine.resize());

    // Ajoutez les événements pour la mise à jour du configurateur
    ["width", "height", "vantaux", "couleur", "vitrage"].forEach(id => {
      document.getElementById(id).addEventListener("input", debounceUpdate);
      document.getElementById(id).addEventListener("change", debounceUpdate);
    });

    function debounceUpdate() {
      clearTimeout(updateTimeout);
      updateTimeout = setTimeout(updateWindow, 500);
    }
    //updateWindow();
    engine.runRenderLoop(() => scene.render());
    window.addEventListener("resize", () => engine.resize());
    ["width", "height",  "vantaux", "couleur", "vitrage"].forEach(id => {
      document.getElementById(id).addEventListener("input", debounceUpdate);
      document.getElementById(id).addEventListener("change", debounceUpdate);
    });
	
	function updateSectionVisibility() {
      const addAllege = document.getElementById("addAllege").checked;
      const allegeHeightSection = document.getElementById("allegeHeightSection");
      const addImposte = document.getElementById("addImposte").checked;
      const imposteHeightSection = document.getElementById("imposteHeightSection");

      allegeHeightSection.style.display = addAllege ? "block" : "none";
      imposteHeightSection.style.display = addImposte ? "block" : "none";
    }
	
	document.getElementById("addAllege").addEventListener("change", updateSectionVisibility);
    document.getElementById("addImposte").addEventListener("change", updateSectionVisibility);
	
	document.getElementById("addAllege").addEventListener("change", updateWindow);
    document.getElementById("allegeHeight").addEventListener("input", updateWindow);
    document.getElementById("addImposte").addEventListener("change", updateWindow);
    document.getElementById("imposteHeight").addEventListener("input", updateWindow);
  </script>
</body>
</html>